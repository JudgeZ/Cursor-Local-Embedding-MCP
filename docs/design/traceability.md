# Architecture Traceability Index

This index links the architecture commitments in the finalized overview to the subsystem specifications, required failing tests, and security review artifacts that collectively deliver the platform. Use it during planning and pull-request review to verify that each commitment has design depth, executable coverage, and documented mitigations. Cross-reference the [External References Catalog](../references/sources.md) for the authoritative sources that back each checklist and subsystem expectation.

## Traceability Map

| Architectural concern | Supporting specs | Required failing tests | Security checklist alignment |
| --- | --- | --- | --- |
| Deterministic workspace ingestion (ignore stacks, archive handling, sanitizer enforcement) | [Ingestion Pipeline Specification](./ingestion.md), [Vector Store Specification](./vector-store.md) | [Embedding Engine Core](../testing/test-matrix.md#embedding-engine-core), [Filesystem Watch Service](../testing/test-matrix.md#filesystem-watch-service), [Archive Extraction Quotas](../testing/test-matrix.md#archive-extraction-quotas) | [Input Validation Checklist](../security/threat-model.md#input-validation-checklist), [Sandboxing Checklist](../security/threat-model.md#sandboxing-checklist) |
| Transport adapters for CLI/IDE/automation (loopback binding, framing, WSL path translation) | [Transport Adapter Specification](./transport.md) | [Client Tooling (CLI & SDK)](../testing/test-matrix.md#client-tooling-cli--sdk), [IDE Extensions](../testing/test-matrix.md#ide-extensions) | [Input Validation Checklist](../security/threat-model.md#input-validation-checklist) |
| Encrypted persistence, key rotation, and attested ledger writes | [Encryption Engine Specification](./encryption.md), [Vector Store Specification](./vector-store.md) | [Secure Storage & Retrieval](../testing/test-matrix.md#secure-storage--retrieval), [Encryption & TLS Controls](../testing/test-matrix.md#encryption--tls-controls), [Multi-Repository Routing](../testing/test-matrix.md#multi-repository-routing) | [Encryption Checklist](../security/threat-model.md#encryption-checklist) |
| Multi-repository orchestration and manifest governance | [Overview – Local Ingestion Pipeline](./overview.md#local-ingestion-pipeline), [Vector Store Specification](./vector-store.md) | [Multi-Repository Routing](../testing/test-matrix.md#multi-repository-routing) | [Encryption Checklist](../security/threat-model.md#encryption-checklist), [Sandboxing Checklist](../security/threat-model.md#sandboxing-checklist) |
| Offline-first operation and cross-platform parity (Linux, macOS, WSL) | [Overview – Platform Support and Operational Guidance](./overview.md#platform-support-and-operational-guidance), cross-platform notes in [Ingestion](./ingestion.md#cross-cutting-concerns), [Transport](./transport.md#cross-cutting-concerns), and [Vector Store](./vector-store.md#cross-cutting-concerns) | _Gap: targeted offline/WSL regression suites not yet enumerated_ | [Sandboxing Checklist](../security/threat-model.md#sandboxing-checklist) |

## Gap Analysis & Follow-Up Actions

1. **WSL-specific validation coverage** – The architecture promises resilient WSL transport interop and log persistence, yet no failing tests currently target WSL-specific flows inside the transport or storage matrices. Author new failing scenarios under the Client Tooling and Secure Storage suites that exercise WSL path translation and DPAPI-backed key recovery, then document the expected telemetry in the relevant design specs. (_Owners_: transport + encryption teams.)
2. **Archive quota enforcement details** – While the test matrix enumerates Archive Extraction Quotas, the ingestion design only references quotas at a high level. Extend `docs/design/ingestion.md` with explicit quota calculation algorithms, latency budgets, and failure handling so the tests can trace back to concrete requirements. (_Owner_: ingestion team.)
3. **Missing security checklist sections** – Several specs cite Authentication, Access Control, File Handling, and Key Management checklists that are absent from `docs/security/threat-model.md`. Add these checklist sections (or adjust references) so PR reviewers can validate the mitigations promised in the architecture. (_Owner_: security documentation team.)
4. **Offline-first resilience testing** – Offline queuing and replay behaviors are architectural commitments, but the test matrix does not yet include degraded-network or air-gapped scenarios. Introduce failing tests (e.g., transport retry buffers, ingestion manifest replays) and link them to the offline expectations documented in the specs. (_Owner_: cross-functional runtime team.)

## Using This Index During Planning and Review

- Planning must follow the repository-wide workflow in [AGENTS.md](../AGENTS.md), ensuring implementation plans cite the design and testing entries above before coding begins.
- During PR review, complete the [PR release checklist](../process/pr-release-checklist.md) and reference this traceability map when confirming design updates, failing test evidence, and security checklist coverage.
